# PvZ-AI
ИИ для Plants vs Zombies (написано на Claude sonnet 4.5 + улучшения)

## Обзор
ИИ использует YOLO для распознавания игровых объектов и стратегическую систему для автоматической защиты от зомби.

[Внедрён YOLO для анализа классов: sunflower, peas (peashooter), sun, coin, zombie]

## ✨ Новые Функции (v2.0)

### 1. Система Перезарядки Растений
Реализована полная система cooldown для всех растений:
- **Sunflower**: 0 сек. начальная, 7.5 сек. перезарядка
- **Peashooter**: 0 сек. начальная, 8.5 сек. перезарядка
- **Wall-nut**: 20.5 сек. начальная, 33.5 сек. перезарядка
- **Cherry Bomb**: 37.5 сек. начальная, 50.5 сек. перезарядка

ИИ теперь понимает, когда можно использовать каждое растение и не пытается посадить растение до окончания cooldown.

### 2. Ограничение Зон для Горохострелов
Горохострелы теперь можно сажать только в определённых зонах:
- **Ряды**: 2, 3, 4 (средние ряды)
- **Колонки**: 1, 2, 3, 4, 5

Это обеспечивает лучшую защиту и оставляет место для других растений.

### 3. Приоритет 3 Подсолнуха
ИИ сначала сажает **3 подсолнуха** в колонке 0 (ряды 1, 2, 3), затем начинает строить защиту.

### 4. Улучшенная Логика Вишни (Cherry Bomb)

#### 4.1 Защита Горохострелов
Вишня автоматически используется, когда зомби подходит слишком близко к горохострелу:
- Проверяется расстояние между зомби и горохострелом
- Если расстояние ≤ 2 клеток, используется вишня

#### 4.2 Обнаружение Групп
Вишня используется при обнаружении группы зомби в области 3x3:
- Сканируется поле на наличие скоплений зомби
- Если 3+ зомби находятся в области 3x3, используется вишня
- Вишня размещается в центре группы для максимального урона

### 5. Определение Приоритета Зомби
ИИ теперь определяет **ближайшего зомби** в каждом ряду:
- Отслеживает положение всех зомби
- Находит ближайшего зомби по каждому ряду
- Приоритизирует защиту рядов с ближайшими зомби
- Сажает горохострелы в рядах с наибольшей угрозой

## Функциональность

### Автоматические Действия:
- ✅ Сбор солнц и монет (YOLO detection)
- ✅ Посадка подсолнухов (приоритет: 3 подсолнуха вначале)
- ✅ Посадка горохострелов (ограничено рядами 2,3,4 и колонками 1-5)
- ✅ Посадка орехов (wall-nut, tall-nut)
- ✅ Умное использование вишни:
  - При группах зомби (3+ в области 3x3)
  - При близких зомби к горохострелам (≤2 клеток)
  - В аварийных ситуациях
- ✅ Отслеживание cooldown всех растений
- ✅ Определение приоритета зомби (ближайший = опаснейший)

### Стратегия:
1. **Фаза 1**: Сажаем 3 подсолнуха (ряды 1, 2, 3, колонка 0)
2. **Фаза 2**: Начинаем защиту рядов 2, 3, 4 горохострелами
3. **Фаза 3**: Реагируем на зомби (приоритет ближайшим)
4. **Фаза 4**: Аварийная защита (вишни, squash, wall-nut)
5. **Фаза 5**: Экономическое развитие (2 дополнительных подсолнуха при 300+ солнц)

## Использование

### Установка
```bash
pip install ultralytics pyautogui opencv-python keyboard
```

### Запуск
```bash
python main.py
```

### Настройка
При первом запуске:
1. Выберите количество слотов для растений
2. Назначьте растения на слоты
3. Настройки сохранятся в `plant_config.json`

### Управление в игре
- `[Z]` - Старт/Пауза
- `[R]` - Сброс стратегии (новый уровень)
- `[P]` - Показать карту растений
- `[S]` - Показать статистику
- `[C]` - Собрать солнца вручную
- `[X]` - Выход

## Конфигурация

### Настройки cooldown (`config.py`)
```python
PLANT_COOLDOWNS = {
    "sunflower": (0.0, 7.5),
    "peashooter": (0.0, 8.5),
    "wall-nut": (20.5, 33.5),
    "cherry bomb": (37.5, 50.5),
    # ... другие растения
}
```

### Настройки зон горохострелов
```python
PEASHOOTER_ROWS = [1, 2, 3]  # Ряды 2, 3, 4
PEASHOOTER_COLS = [1, 2, 3, 4, 5]  # Колонки 1-5
```

### Настройки вишни
```python
CHERRY_BOMB_DANGER_DISTANCE = 2  # Дистанция угрозы для горохострела
CHERRY_BOMB_MIN_ZOMBIES = 3  # Мин. зомби для использования вишни
```

## Технические Детали

### Архитектура
- **YOLO v8**: Обнаружение игровых объектов
- **CooldownManager**: Управление временем перезарядки
- **PlantingStrategy**: Стратегическое планирование
- **SunTracker**: Отслеживание ресурсов
- **GameController**: Взаимодействие с игрой

### Алгоритмы
- **Приоритет зомби**: Сортировка по расстоянию до растений
- **Кластеризация**: Обнаружение групп зомби в области 3x3
- **Защита хитбокса**: Проверка расстояний между зомби и горохострелами

## Улучшения v2.0
- ✅ Заставить ИИ ставить 3 подсолнуха перед защитой
- ✅ Определить кто первым идет по клетке (приоритет зомби)
- ✅ Использовать вишню при толпе зомби
- ✅ Добавить cooldown на семена
- ✅ Ограничить зоны размещения горохострелов
- ✅ Отслеживание близости зомби к горохострелам

## Требования
- Python 3.7+
- Windows/Linux/macOS
- Обученная YOLO модель (`assets/yolov8_pvz.pt`)

## Автор
Создано с помощью Claude Sonnet 4.5
Улучшено и доработано в v2.0
